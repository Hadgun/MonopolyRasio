<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monopoly Rasio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        #prolog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c5f2d 0%, #97bc62 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: white;
            text-align: center;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
        }

        #prolog h1 {
            font-size: 3.5em;
            margin-bottom: 30px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            animation: bounce 1s infinite;
        }

        #prolog p {
            font-size: 1.4em;
            max-width: 800px;
            line-height: 1.8;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        #playerSelection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4a90e2 0%, #9013fe 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }

        #playerSelection h2 {
            font-size: 3em;
            margin-bottom: 40px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
        }

        .player-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .player-btn {
            padding: 20px 40px;
            font-size: 2em;
            background: white;
            color: #4a90e2;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }

        .player-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 20px rgba(0,0,0,0.4);
        }

        #gameContainer {
            width: 100vw;
            height: 100vh;
            display: none;
            position: relative;
        }

        #boardGame {
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(180deg, #87CEEB 0%, #90EE90 100%);
            position: relative;
            overflow: hidden;
        }
        
        #boardGame::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        :root{
            --board-size: 90vmin;
            --board-max: 900px;
        }

        .board-container {
            width: var(--board-size);
            height: var(--board-size);
            max-width: var(--board-max);
            max-height: var(--board-max);
            position: relative;
            background: linear-gradient(135deg, #6B8E23 0%, #8FBC8F 50%, #6B8E23 100%);
            border: 8px solid #8B4513;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .board-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50%;
            height: 50%;
            background: linear-gradient(135deg, #F0E68C 0%, #DEB887 100%);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-shadow: inset 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .board-title {
            font-size: 2.5em;
            font-weight: bold;
            color: #2c5f2d;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.5);
            margin-bottom: 10px;
        }
        
        .board-rules {
            background: rgba(139, 69, 19, 0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.7em;
            line-height: 1.4;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .tile {
            position: absolute;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 3px solid #4a4a4a;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            padding: 5px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            transition: all 0.3s;
            z-index: 5;
        }
        
        .tile:hover {
            transform: scale(1.05);
            z-index: 10;
        }
        
        .tile-icon {
            font-size: 1.8em;
            margin-bottom: 3px;
        }
        
        .tile-name {
            font-size: 0.65em;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            line-height: 1.1;
        }
        
        .tile.corner {
            width: 16%;
            height: 16%;
        }
        
        .tile.horizontal {
            width: 10%;
            height: 16%;
        }
        
        .tile.vertical {
            width: 16%;
            height: 10%;
        }
        
        .tile.special {
            background: linear-gradient(135deg, #CD853F 0%, #8B4513 100%);
        }
        
        .tile.bridge {
            background: linear-gradient(135deg, #87CEEB 0%, #4682B4 100%);
        }
        
        .tile.tame {
            background: linear-gradient(135deg, #90EE90 0%, #3CB371 100%);
        }
        
        .tile.wild {
            background: linear-gradient(135deg, #F4A460 0%, #D2691E 100%);
        }

        .tile.pit {
            background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
        }

        .player-piece {
            position: absolute;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
            transition: all 0.4s ease;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 1em;
            background-size: cover;
            background-position: center;
        }
        
        .player-piece.active {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        #ui {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            min-width: 250px;
            z-index: 100;
        }

        /* Responsive adjustments */
        @media (max-width: 900px) {
            :root{ --board-size: 92vw; }

            #ui{
                left: 50%;
                right: auto;
                transform: translateX(-50%);
                bottom: 12px;
                top: auto;
                width: calc(100% - 24px);
                min-width: auto;
                padding: 12px;
                display: flex;
                gap: 10px;
                align-items: center;
            }

            #rollButton{ flex: 1; }
            .player-info{ display:none; }
            
            .tile-icon { font-size: 1.5em; }
            .tile-name { font-size: 0.6em; }
        }

        #ui h3 {
            margin-bottom: 15px;
            color: #2c5f2d;
            font-size: 1.5em;
        }

        .player-info {
            margin: 10px 0;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
            border-left: 5px solid #4a90e2;
        }

        .player-info.active {
            border-left-color: #f39c12;
            background: #fff3cd;
        }

        #rollButton {
            width: 100%;
            padding: 15px;
            font-size: 1.3em;
            background: linear-gradient(135deg, #f39c12 0%, #e74c3c 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        #rollButton:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        #rollButton:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #cardModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .card {
            background: white;
            padding: 0;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: slideIn 0.5s;
            overflow: hidden;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .card-header {
            padding: 20px;
            text-align: center;
            color: white;
            font-size: 2em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .card-header.blue {
            background: linear-gradient(135deg, #89CFF0 0%, #4A90E2 100%);
        }

        .card-header.red {
            background: linear-gradient(135deg, #FF9999 0%, #FF6B6B 100%);
        }

        .card-body {
            padding: 30px;
        }

        .card-body p {
            font-size: 1.3em;
            margin-bottom: 25px;
            line-height: 1.6;
            color: #333;
        }

        .answer-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .answer-btn {
            padding: 15px;
            font-size: 1.2em;
            border: 3px solid #ddd;
            background: white;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .answer-btn:hover {
            transform: scale(1.05);
            border-color: #4A90E2;
        }

        .answer-btn.blue {
            background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
        }

        .answer-btn.red {
            background: linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 100%);
        }

        .answer-btn.correct {
            background: #4CAF50 !important;
            color: white;
            border-color: #4CAF50;
        }

        .answer-btn.wrong {
            background: #f44336 !important;
            color: white;
            border-color: #f44336;
        }

        #closeCard {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
        }

        #closeCard:hover {
            background: #7f8c8d;
        }

        .result-message {
            text-align: center;
            font-size: 1.5em;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }

        .result-message.correct {
            background: #d4edda;
            color: #155724;
        }

        .result-message.wrong {
            background: #f8d7da;
            color: #721c24;
        }

        #winModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        /* Avatar selection modal */
        #avatarModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 11000;
        }

        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .avatar-item {
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            border: 4px solid transparent;
            transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.2s;
        }

        .avatar-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display:block;
        }

        .avatar-item.selected {
            transform: scale(1.06);
            box-shadow: 0 12px 30px rgba(0,0,0,0.5);
            border-color: #f39c12;
        }

        @keyframes avatarPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

        .avatar-item.pulse {
            animation: avatarPulse 1s infinite;
        }

        .win-content {
            background: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            animation: slideIn 0.5s;
        }

        .win-content h2 {
            font-size: 3em;
            color: #f39c12;
            margin-bottom: 20px;
        }

        .win-content p {
            font-size: 1.5em;
            margin: 10px 0;
        }

        #restartBtn {
            padding: 20px 40px;
            font-size: 1.5em;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
        }

        #restartBtn:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <!-- Prolog -->
    <div id="prolog">
        <h1>üèïÔ∏è MONOPOLY RASIO üèïÔ∏è</h1>
        <p>Suatu hari, sekelompok anak Pramuka sedang melakukan jelajah alam di Gunung Gede. Awalnya perjalanan terasa menyenangkan, namun tanpa disadari mereka tersesat di jalur pendakian.</p>
        <p>Di sepanjang perjalanan, kalian akan bertemu hewan penjaga alam. Hewan jinak akan memberi tantangan melalui kartu biru, sedangkan hewan buas akan memberi tantangan melalui kartu merah. Selain itu, terdapat rintangan alam berupa jembatan yang membawa kalian maju dua langkah dan jurang yang memaksa kalian mundur tiga langkah.</p>
        <p>Untuk bisa keluar dari jalur dan mencapai FINISH, kalian harus menyelesaikan setiap tantangan dengan kerja sama dan strategi yang tepat.</p>
    </div>

    <!-- Player Selection -->
    <div id="playerSelection">
        <h2>üéÆ Pilih Jumlah Pemain üéÆ</h2>
        <div class="player-buttons">
            <button class="player-btn" onclick="pickAvatars(1)">1 Pemain</button>
            <button class="player-btn" onclick="pickAvatars(2)">2 Pemain</button>
            <button class="player-btn" onclick="pickAvatars(3)">3 Pemain</button>
            <button class="player-btn" onclick="pickAvatars(4)">4 Pemain</button>
        </div>
    </div>

    <!-- Game Container -->
    <div id="gameContainer">
        <div id="boardGame">
            <div class="board-container" id="boardContainer">
                <div class="board-center">
                    <div class="board-title">MATHPOLY<br>RASIO</div>
                    <div class="board-rules">
                        <strong>PERATURAN:</strong><br>
                        1. Setup kelompok melempar dadu dan maju sesuai angka<br>
                        2. Jika berhenti di petak hewan jinak, ambil kartu biru<br>
                        3. Jika berhenti di petak hewan buas, ambil kartu merah<br>
                        4. Jika berhenti di jembatan, maju 2 langkah<br>
                        5. Jika berhenti di jurang, mundur 3 langkah<br>
                        6. Kelompok yang mencapai FINISH dan memiliki poin terbanyak menjadi pemenang
                    </div>
                </div>
            </div>
        </div>
        
        <!-- UI Panel -->
        <div id="ui">
            <h3>üìä Status Pemain</h3>
            <div id="playersList"></div>
            <button id="rollButton">üé≤ Lempar Dadu</button>
            <button id="musicToggle" style="margin-top:8px;background:linear-gradient(135deg,#6f9ce8,#3aa3bd);color:white;border:none;padding:10px;border-radius:8px;cursor:pointer;">üîä Musik</button>
            <audio id="bgMusic" src="assets/sound/background.mp3.mp3" loop preload="auto"></audio>
            <audio id="diceSound" src="assets/sound/dice.mp3" preload="auto"></audio>
            <audio id="selectSound" src="assets/sound/select.mp3" preload="auto"></audio>
            <audio id="moveSound1" src="assets/sound/move1.mp3" preload="auto"></audio>
            <audio id="moveSound2" src="assets/sound/move2.mp3" preload="auto"></audio>
            <audio id="moveSound3" src="assets/sound/move3.mp3" preload="auto"></audio>
            <audio id="moveSound4" src="assets/sound/move4.mp3" preload="auto"></audio>
        </div>
    </div>

    <!-- Avatar Selection Modal -->
    <div id="avatarModal" style="display:none;">
        <div class="card" style="max-width:700px;">
            <div class="card-header blue">Pilih Avatar</div>
            <div class="card-body">
                <p id="avatarPrompt">Pilih avatar untuk Pemain 1</p>
                <div class="avatar-grid" id="avatarGrid"></div>
                <div style="display:flex;gap:10px;margin-top:16px;justify-content:center;">
                    <button id="avatarPrev" class="answer-btn" style="display:none;">Kembali</button>
                    <button id="avatarNext" class="answer-btn blue">Konfirmasi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Card Modal -->
    <div id="cardModal">
        <div class="card">
            <div class="card-header" id="cardHeader">POIN 5</div>
            <div class="card-body">
                <p id="questionText"></p>
                <div class="answer-grid" id="answersGrid"></div>
                <div id="resultMessage"></div>
                <button id="closeCard">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Win Modal -->
    <div id="winModal">
        <div class="win-content">
            <h2>üéâ SELAMAT! üéâ</h2>
            <p id="winnerText"></p>
            <button id="restartBtn">Main Lagi</button>
        </div>
    </div>

    <script>
        // Game Data
        const BLUE_CARDS = [
            { q: "Tinggi Badan Zaki 150 cm dan Arya 135 cm. Rasio tinggi badan Zaki dan Arya adalah...", a: ["10:9", "15:14", "9:10", "5:4"], correct: 0 },
            { q: "Perbandingan kelereng merah dan biru adalah 3:5. Jika terdapat 9 kelereng merah, maka kelereng biru adalah...", a: ["12", "18", "15", "10"], correct: 2 },
            { q: "Rasio umur Ahmad dan Ariq adalah 2:3. Jika umur Ahmad 8 tahun maka umur Ariq adalah...", a: ["10 tahun", "12 tahun", "11 tahun", "14 tahun"], correct: 1 },
            { q: "Berat badan Nadia 45 kg dan Fitri 36 kg. Rasio berat badan Nadia dan Fitri adalah...", a: ["4:3", "3:4", "4:5", "5:4"], correct: 3 },
            { q: "Campuran sirup dan air adalah 1:4. Jika airnya 8 gelas, maka sirupnya...", a: ["1 gelas", "4 gelas", "2 gelas", "6 gelas"], correct: 2 },
            { q: "Perbandingan umur ayah dan anak adalah 5:1. Jika ayah berumur 40 tahun, maka anaknya berumur...", a: ["5 tahun", "10 tahun", "8 tahun", "12 tahun"], correct: 2 },
            { q: "Rasio uang Adi dan Arfan adalah 2:3. Jika uang Arfan Rp.15.000, maka uang Adi adalah...", a: ["Rp.8.000", "Rp.12.000", "Rp.10.000", "Rp.14.000"], correct: 2 },
            { q: "Rasio panjang pita merah dan kuning adalah 4:6. Jika panjang pita merah 12 cm, maka panjang pita kuning...", a: ["5 cm", "10 cm", "18 cm", "12 cm"], correct: 2 },
            { q: "Di taman ada 8 ekor kupu-kupu dan 4 ekor kucing. Rasio kupu-kupu dan kucing adalah...", a: ["2:1", "1:3", "1:2", "3:1"], correct: 0 },
            { q: "Terdapat 9 bola merah dan 6 bola biru. Rasio bola merah dan bola biru adalah...", a: ["3:2", "1:3", "2:3", "3:1"], correct: 0 },
            { q: "Perbandingan jumlah pensil Ranti dan Reno adalah 4:5. Jika Ranti memiliki 12 pensil, maka pensil Reno adalah...", a: ["10", "12", "15", "20"], correct: 2 },
            { q: "Di kelas terdapat 18 siswa laki-laki dan 12 siswa perempuan. Rasio siswa laki-laki dan perempuan adalah...", a: ["2:3", "3:2", "4:3", "3:4"], correct: 1 },
            { q: "Perbandingan gula dan tepung adalah 2:5. Jika tepung 250 g, maka gula yang digunakan adalah...", a: ["80 g", "90 g", "100 g", "125 g"], correct: 2 },
            { q: "Perbandingan jumlah apel dan jeruk adalah 5:3. Jika jumlah apel 20 buah, maka jeruk adalah...", a: ["10 buah", "12 buah", "15 buah", "18 buah"], correct: 1 },
            { q: "Perbandingan jarak rumah Arkan dan Rina ke sekolah adalah 4:6. Jika jarak Arkan 8 km, maka jarak Rina adalah...", a: ["10 km", "12 km", "14 km", "16 km"], correct: 1 }
        ];

        const RED_CARDS = [
            { q: "Waktu tempuh Andi dan Raihan berbanding 3:4. Jika Andi 45 menit, maka Raihan...", a: ["50 menit", "60 menit", "55 menit", "65 menit"], correct: 1 },
            { q: "Dalam kelas, rasio siswa yang suka matematika dan IPA 4:3. Jika ada 28 siswa, berapa yang suka IPA?", a: ["10", "12", "16", "14"], correct: 1 },
            { q: "Perbandingan usia Toni dan Dani adalah 3:5. Jika jumlah usia mereka 24 tahun, berapa usia Toni dan Dani?", a: ["9 th & 15 th", "6 th & 14 th", "9 th & 14 th", "8 th & 12 th"], correct: 0 },
            { q: "Penjahit E menyelesaikan 150 potong pakaian dalam 2 minggu, sedangkan penjahit F dalam 10 hari. Rasio waktu bekerja E dan F adalah...", a: ["5:7", "2:3", "7:5", "3:4"], correct: 2 },
            { q: "Perbandingan usia Lia dan Via 3:5, jika selisih usia mereka 6 tahun. Berapa usia Lia dan Via?", a: ["7 th & 11 th", "10 th & 12 th", "9 th & 15 th", "5 th & 10 th"], correct: 2 },
            { q: "Seekor sapi makan 12 kg rumput setiap hari. Jika domba makan 8 kg, maka rasio makan sapi dan domba adalah...", a: ["2:1", "4:3", "3:2", "1:2"], correct: 2 },
            { q: "Rasio panjang jalan A dan B adalah 5:2. Jika panjang jalan A 15 km, maka panjang jalan B adalah...", a: ["5 km", "8 km", "6 km", "9 km"], correct: 2 },
            { q: "Perbandingan uang Rudi, Dodi, dan Nita adalah 2:3:5. Jika uang Dodi Rp9.000, maka total uang mereka adalah...", a: ["Rp25.000", "Rp45.000", "Rp30.000", "Rp50.000"], correct: 2 },
            { q: "Perbandingan jumlah apel dan jeruk adalah 6:4. Jika jumlah apel 24 buah, maka jeruk adalah...", a: ["12", "14", "16", "18"], correct: 2 },
            { q: "Perbandingan panjang pita merah dan kuning adalah 4:7. Jika selisih 21 cm, maka pita merah adalah...", a: ["28 cm", "32 cm", "36 cm", "40 cm"], correct: 0 }
        ];

        // Board tiles configuration
        const TILES = [
            { name: "START", type: "special", icon: "üèïÔ∏è" },
            { name: "JURANG", type: "pit", icon: "‚ö†Ô∏è" },
            { name: "JEMBATAN", type: "bridge", icon: "üåâ" },
            { name: "TUPAI", type: "tame", icon: "üêøÔ∏è" },
            { name: "HARIMAU", type: "wild", icon: "üêÖ" },
            { name: "KELINCI", type: "tame", icon: "üê∞" },
            { name: "JEMBATAN", type: "bridge", icon: "üåâ" },
            { name: "ULAR", type: "wild", icon: "üêç" },
            { name: "RUSA", type: "tame", icon: "ü¶å" },
            { name: "SINGA", type: "wild", icon: "ü¶Å" },
            { name: "KURA-KURA", type: "tame", icon: "üê¢" },
            { name: "BUAYA", type: "tame", icon: "üêä" },
            { name: "GAJAH", type: "tame", icon: "üêò" },
            { name: "ELANG", type: "tame", icon: "ü¶Ö" },
            { name: "SERACAU", type: "tame", icon: "ü¶ú" },
            { name: "ORANG UTAN", type: "wild", icon: "ü¶ß" },
            { name: "TUPAI 2", type: "tame", icon: "üêøÔ∏è" },
            { name: "LANDAK", type: "tame", icon: "ü¶î" },
            { name: "MUSANG", type: "wild", icon: "ü¶ù" },
            { name: "TALO", type: "wild", icon: "üêÜ" },
            { name: "FINISH", type: "special", icon: "üèÅ" }
        ];

        // Game State
        let players = [];
        let currentPlayerIndex = 0;
        let isRolling = false;
        let playerPieces = [];
        let gameStarted = false;
        
        // Avatar selection state
        const AVATAR_CHOICES = [
            'assets/img/char1.png',
            'assets/img/char2.png',
            'assets/img/char3.png',
            'assets/img/char4.png'
        ];
        let avatarPickCount = 0;
        let avatarCurrentIndex = 0;
        let chosenAvatars = [];

        // Show prolog for 7 seconds
        setTimeout(() => {
            document.getElementById('prolog').style.display = 'none';
            document.getElementById('playerSelection').style.display = 'flex';
        }, 7000);

        function startGame(numPlayers, avatars = []) {
            document.getElementById('playerSelection').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
            
            // Initialize players
            const colors = ['#FF6B6B', '#4ECDC4', '#FFD93D', '#95E1D3'];
            const names = ['Pemain 1', 'Pemain 2', 'Pemain 3', 'Pemain 4'];
            
            for (let i = 0; i < numPlayers; i++) {
                players.push({
                    name: names[i],
                    position: 0,
                    score: 0,
                    color: colors[i],
                    avatar: avatars[i] || null,
                    avatarIndex: (avatars[i] ? (AVATAR_CHOICES.indexOf(avatars[i]) >= 0 ? AVATAR_CHOICES.indexOf(avatars[i]) : i) : i),
                    finished: false
                });
            }
            
            gameStarted = true;
            createBoard();
            createPlayerPieces();
            updatePlayersList();
            
            // Event listeners
            document.getElementById('rollButton').addEventListener('click', rollDice);
            document.getElementById('closeCard').addEventListener('click', closeCard);
            document.getElementById('restartBtn').addEventListener('click', () => location.reload());

            // Music toggle behavior
            const bgMusic = document.getElementById('bgMusic');
            const musicToggle = document.getElementById('musicToggle');
            if (musicToggle) {
                musicToggle.addEventListener('click', () => {
                    try {
                        if (bgMusic.paused) {
                            bgMusic.play();
                            musicToggle.textContent = 'üîà Matikan Musik';
                        } else {
                            bgMusic.pause();
                            musicToggle.textContent = 'üîä Musik';
                        }
                    } catch (e) {
                        console.warn('Audio playback prevented by browser settings.');
                    }
                });
            }
        }

        function createBoard() {
            const container = document.getElementById('boardContainer');
            const center = container.querySelector('.board-center');
            container.innerHTML = '';
            if (center) container.appendChild(center);

            // Define board dimensions
            const boardSize = 100; // percentage
            const cornerSize = 16; // corner tiles are bigger
            const sideTileWidth = 10;
            const sideTileHeight = 16;
            
            // Define positions for each side (21 tiles total)
            // Sisi Bawah: 6 tiles (indeks 0-5)
            // Sisi Kanan: 5 tiles (indeks 6-10)
            // Sisi Atas: 6 tiles (indeks 11-16)
            // Sisi Kiri: 4 tiles (indeks 17-20)
            
            TILES.forEach((tile, index) => {
                const tileEl = document.createElement('div');
                tileEl.className = `tile ${tile.type}`;
                
                // Determine position based on index
                let left, top, orientation;
                
                if (index === 0) { // START (kiri bawah)
                    tileEl.classList.add('corner');
                    left = 0;
                    top = boardSize - cornerSize;
                } 
                else if (index >= 1 && index <= 5) { // Sisi Bawah (horizontal)
                    tileEl.classList.add('horizontal');
                    left = cornerSize + (index - 1) * ((boardSize - 2 * cornerSize) / 5);
                    top = boardSize - sideTileHeight;
                }
                else if (index === 6) { // Sudut Kanan Bawah
                    tileEl.classList.add('corner');
                    left = boardSize - cornerSize;
                    top = boardSize - cornerSize;
                }
                else if (index >= 7 && index <= 10) { // Sisi Kanan (vertikal)
                    tileEl.classList.add('vertical');
                    left = boardSize - sideTileHeight;
                    top = boardSize - cornerSize - (index - 6) * ((boardSize - 2 * cornerSize) / 5);
                }
                else if (index === 11) { // Sudut Kanan Atas
                    tileEl.classList.add('corner');
                    left = boardSize - cornerSize;
                    top = 0;
                }
                else if (index >= 12 && index <= 16) { // Sisi Atas (horizontal)
                    tileEl.classList.add('horizontal');
                    left = boardSize - cornerSize - (index - 11) * ((boardSize - 2 * cornerSize) / 5);
                    top = 0;
                }
                else if (index === 17) { // Sudut Kiri Atas
                    tileEl.classList.add('corner');
                    left = 0;
                    top = 0;
                }
                else if (index >= 18 && index <= 20) { // Sisi Kiri (vertikal)
                    tileEl.classList.add('vertical');
                    left = 0;
                    top = (index - 17) * ((boardSize - 2 * cornerSize) / 4);
                }
                else { // FINISH (indeks 20) - Kiri Bawah
                    tileEl.classList.add('corner');
                    left = 0;
                    top = boardSize - cornerSize;
                }
                
                tileEl.style.left = `${left}%`;
                tileEl.style.top = `${top}%`;
                
                tileEl.innerHTML = `
                    <div class="tile-icon">${tile.icon}</div>
                    <div class="tile-name">${tile.name}</div>
                `;
                
                tileEl.dataset.index = index;
                container.appendChild(tileEl);
                tile.element = tileEl;
            });
        }

        function createPlayerPieces() {
            const container = document.getElementById('boardContainer');
            players.forEach((player, index) => {
                const piece = document.createElement('div');
                piece.className = 'player-piece';
                piece.dataset.player = index;
                if (player.avatar) {
                    piece.style.backgroundImage = `url(${player.avatar})`;
                    piece.style.backgroundSize = 'cover';
                    piece.style.backgroundPosition = 'center';
                    piece.textContent = '';
                } else {
                    piece.style.backgroundColor = player.color;
                    piece.textContent = index + 1; // Show player number
                }
                
                container.appendChild(piece);
                playerPieces.push(piece);
                
                setTimeout(() => updatePiecePosition(index), 50);
            });
        }

        function updatePiecePosition(playerIndex) {
            const player = players[playerIndex];
            const tile = TILES[player.position];
            
            if (!tile || !tile.element) return;
            
            const piece = playerPieces[playerIndex];
            const tileEl = tile.element;
            const containerRect = document.getElementById('boardContainer').getBoundingClientRect();
            const tileRect = tileEl.getBoundingClientRect();
            
            // Calculate offsets for multiple players on same tile
            const playerCount = players.filter(p => p.position === player.position).length;
            const playerOrder = players.slice(0, playerIndex + 1).filter(p => p.position === player.position).length - 1;
            
            const angleStep = (2 * Math.PI) / Math.max(playerCount, 1);
            const angle = playerOrder * angleStep;
            const radius = tileRect.width * 0.3;
            
            const offsetX = Math.cos(angle) * radius;
            const offsetY = Math.sin(angle) * radius;
            
            // Position piece at center of tile
            const tileCenterX = tileRect.left + tileRect.width / 2;
            const tileCenterY = tileRect.top + tileRect.height / 2;
            
            piece.style.left = (tileCenterX - containerRect.left + offsetX - 17.5) + 'px';
            piece.style.top = (tileCenterY - containerRect.top + offsetY - 17.5) + 'px';
            
            // Update active state
            document.querySelectorAll('.player-piece').forEach(p => p.classList.remove('active'));
            if (playerIndex === currentPlayerIndex && !isRolling) {
                piece.classList.add('active');
            }
        }

        function rollDice() {
            if (isRolling || players[currentPlayerIndex].finished) return;
            
            isRolling = true;
            document.getElementById('rollButton').disabled = true;
            document.getElementById('rollButton').textContent = 'üé≤ Melempar...';

            // play dice sound
            try {
                const dice = document.getElementById('diceSound');
                if (dice) { dice.currentTime = 0; dice.play(); }
            } catch (e) { /* ignore */ }
            
            setTimeout(() => {
                const result = Math.floor(Math.random() * 6) + 1;
                document.getElementById('rollButton').textContent = `üé≤ Hasil: ${result}`;
                setTimeout(() => {
                    movePlayer(result);
                }, 500);
            }, 1000);
        }

        function movePlayer(steps) {
            const player = players[currentPlayerIndex];
            let targetPosition = player.position + steps;
            
            if (targetPosition >= TILES.length) {
                targetPosition = TILES.length - 1;
                player.finished = true;
            }
            
            animatePlayerMovement(player.position, targetPosition);
        }

        function animatePlayerMovement(start, end) {
            let current = start;
            const moveInterval = setInterval(() => {
                if (current >= end) {
                    clearInterval(moveInterval);
                    players[currentPlayerIndex].position = end;
                    updatePiecePosition(currentPlayerIndex);
                    setTimeout(() => handleTileEffect(end), 500);
                    return;
                }
                
                current++;
                players[currentPlayerIndex].position = current;
                updatePiecePosition(currentPlayerIndex);

                // play move sound mapped to player's avatar
                try {
                    const idx = (players[currentPlayerIndex].avatarIndex !== undefined) ? players[currentPlayerIndex].avatarIndex : 0;
                    const move = document.getElementById(`moveSound${(idx % 4) + 1}`);
                    if (move) { move.currentTime = 0; move.play(); }
                } catch (e) { /* ignore audio errors */ }
            }, 400);
        }

        function handleTileEffect(position) {
            const tile = TILES[position];
            
            if (tile.type === 'bridge') {
                setTimeout(() => {
                    if (players[currentPlayerIndex].position + 2 < TILES.length) {
                        movePlayer(2);
                    } else {
                        players[currentPlayerIndex].position = TILES.length - 1;
                        players[currentPlayerIndex].finished = true;
                        updatePiecePosition(currentPlayerIndex);
                        checkWinner();
                    }
                }, 1000);
            } else if (tile.type === 'pit') {
                setTimeout(() => {
                    const newPos = Math.max(0, players[currentPlayerIndex].position - 3);
                    players[currentPlayerIndex].position = newPos;
                    updatePiecePosition(currentPlayerIndex);
                    nextPlayer();
                }, 1000);
            } else if (tile.type === 'tame') {
                showCard('blue');
            } else if (tile.type === 'wild') {
                showCard('red');
            } else if (tile.name === 'FINISH') {
                checkWinner();
            } else {
                nextPlayer();
            }
        }

        function showCard(type) {
            const cards = type === 'blue' ? BLUE_CARDS : RED_CARDS;
            const card = cards[Math.floor(Math.random() * cards.length)];
            
            const modal = document.getElementById('cardModal');
            const header = document.getElementById('cardHeader');
            const question = document.getElementById('questionText');
            const answersGrid = document.getElementById('answersGrid');
            const resultDiv = document.getElementById('resultMessage');
            
            header.textContent = type === 'blue' ? 'POIN 5' : 'POIN 10';
            header.className = 'card-header ' + type;
            question.textContent = card.q;
            answersGrid.innerHTML = '';
            resultDiv.innerHTML = '';
            
            card.a.forEach((answer, index) => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn ' + type;
                btn.textContent = String.fromCharCode(65 + index) + '. ' + answer;
                btn.onclick = () => checkAnswer(index, card.correct, type);
                answersGrid.appendChild(btn);
            });
            
            modal.style.display = 'flex';
        }

        function checkAnswer(selected, correct, type) {
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === correct) {
                    btn.classList.add('correct');
                } else if (index === selected && index !== correct) {
                    btn.classList.add('wrong');
                }
            });
            
            const resultDiv = document.getElementById('resultMessage');
            const points = type === 'blue' ? 5 : 10;
            
            if (selected === correct) {
                players[currentPlayerIndex].score += points;
                resultDiv.innerHTML = `<div class="result-message correct">‚úÖ BENAR! +${points} Poin</div>`;
            } else {
                resultDiv.innerHTML = `<div class="result-message wrong">‚ùå SALAH! Jawaban yang benar: ${String.fromCharCode(65 + correct)}</div>`;
            }
            
            updatePlayersList();
        }

        function closeCard() {
            document.getElementById('cardModal').style.display = 'none';
            nextPlayer();
        }

        function nextPlayer() {
            if (players[currentPlayerIndex].finished) {
                checkWinner();
                return;
            }
            
            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
            
            // Skip finished players
            let attempts = 0;
            while (players[currentPlayerIndex].finished && attempts < players.length) {
                currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
                attempts++;
            }
            
            if (attempts >= players.length) {
                checkWinner();
                return;
            }
            
            updatePlayersList();
            updatePiecePosition(currentPlayerIndex);
            isRolling = false;
            document.getElementById('rollButton').disabled = false;
            document.getElementById('rollButton').textContent = 'üé≤ Lempar Dadu';
        }

        function checkWinner() {
            const finishedPlayers = players.filter(p => p.finished);
            
            if (finishedPlayers.length > 0) {
                // Sort by score
                finishedPlayers.sort((a, b) => b.score - a.score);
                const winner = finishedPlayers[0];
                
                const winModal = document.getElementById('winModal');
                const winnerText = document.getElementById('winnerText');
                winnerText.innerHTML = `
                    <strong>${winner.name}</strong> menang dengan <strong>${winner.score} poin</strong>!<br><br>
                    ${finishedPlayers.map((p, i) => `${i + 1}. ${p.name}: ${p.score} poin`).join('<br>')}
                `;
                winModal.style.display = 'flex';
            }
        }

        function updatePlayersList() {
            const list = document.getElementById('playersList');
            list.innerHTML = '';
            
            players.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'player-info' + (index === currentPlayerIndex ? ' active' : '');
                div.innerHTML = `
                    <strong>${player.name}</strong><br>
                    Posisi: ${player.position + 1}/${TILES.length}<br>
                    Poin: ${player.score}
                    ${player.finished ? '<br>‚úÖ FINISH' : ''}
                `;
                div.style.borderLeftColor = player.color;
                list.appendChild(div);
            });
        }

        // Avatar selection flow
        function pickAvatars(numPlayers) {
            avatarPickCount = numPlayers;
            avatarCurrentIndex = 0;
            chosenAvatars = [];
            renderAvatarModal();
            // hide the player selection overlay so modal receives clicks
            const ps = document.getElementById('playerSelection');
            if (ps) ps.style.display = 'none';
            document.getElementById('avatarModal').style.display = 'flex';
        }

        function renderAvatarModal() {
            const grid = document.getElementById('avatarGrid');
            grid.innerHTML = '';
            AVATAR_CHOICES.forEach((src, i) => {
                const item = document.createElement('div');
                item.className = 'avatar-item';
                item.dataset.idx = i;
                item.onclick = () => selectAvatar(i);
                const img = document.createElement('img');
                img.src = src;
                item.appendChild(img);
                grid.appendChild(item);
            });

            document.getElementById('avatarPrompt').textContent = `Pilih avatar untuk Pemain ${avatarCurrentIndex + 1}`;
            document.getElementById('avatarPrev').style.display = avatarCurrentIndex > 0 ? 'inline-block' : 'none';
            document.getElementById('avatarNext').textContent = avatarCurrentIndex < avatarPickCount - 1 ? 'Konfirmasi & Lanjut' : 'Selesai';

            // Clear previous selection highlights
            document.querySelectorAll('.avatar-item').forEach(el => el.classList.remove('selected'));
        }

        function selectAvatar(index) {
            // highlight selected
            document.querySelectorAll('.avatar-item').forEach(el => el.classList.remove('selected'));
            const el = document.querySelector(`.avatar-item[data-idx='${index}']`);
            if (el) el.classList.add('selected');
        }

        document.addEventListener('click', (e) => {
            if (e.target && e.target.id === 'avatarNext') {
                const sel = document.querySelector('.avatar-item.selected');
                if (!sel) return; // require selection

                // play select sound
                try {
                    const selSound = document.getElementById('selectSound');
                    if (selSound) { selSound.currentTime = 0; selSound.play(); }
                } catch (e) { /* ignore */ }

                const idx = parseInt(sel.dataset.idx, 10);
                chosenAvatars[avatarCurrentIndex] = AVATAR_CHOICES[idx];
                avatarCurrentIndex++;
                if (avatarCurrentIndex >= avatarPickCount) {
                    document.getElementById('avatarModal').style.display = 'none';
                    startGame(avatarPickCount, chosenAvatars);
                } else {
                    renderAvatarModal();
                }
            }

            if (e.target && e.target.id === 'avatarPrev') {
                if (avatarCurrentIndex > 0) {
                    avatarCurrentIndex--;
                    renderAvatarModal();
                }
            }
        });
    </script>
</body>
</html>